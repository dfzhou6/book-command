# PHP面试题
## php的几种模式
1. apache php_mod 修改php.ini需要重启apache
2. fast-cgi（nginx）修改php.ini需要重启php-fpm
3. cli
4. embed

## cli
cli模式下，具有非常高的性能，可实现常驻内存

## php生命周期
1. 模块初始化
2. 请求初始化
3. 执行脚本
4. 请求关闭
5. 模块关闭

### 1. 模块初始化
0. fpm启动时执行
1. 初始化垃圾回收器
2. 解析php.ini
3. 注册静态、动态模块

### 2. 请求初始化
0. 每个请求都会执行
1. 重置垃圾回收器
2. 初始化编译器、执行器

### 3. 执行脚本
1. 编译、执行

### 4. 请求关闭
1. 关闭编译器、执行器
2. 请求flush输出

### 5. 模块关闭
1. 资源清理、关闭各个模块

## php-fpm模型
1. master主进程
2. worker子进程

### master
负责监听端口、创建、关闭子进程

### worker
负责不断的接收、处理请求

### 进程管理模式
1. 静态模式
2. 动态模式
3. 按需模式

#### 静态模式
子进程数量固定不变

#### 动态模式
子进程数量先初始化，再动态变化

#### 按需模式
子进程需要多少给多少

## 内存管理
1. 引用计数
2. 写时复制

## 内存分配
为了减少频繁向操作系统分配内存，采用预分配的形式。内存使用链表的形式管理，包含空闲链表、使用中链表。
1. chunk 大 2MB
2. page 中 4KB
3. slot 小

## opcode
可以使用opcache对“执行脚本”阶段中，编译出来的opcode就行缓存，加快执行

## JIT
直接将第一次执行的代码编译成机器码，而不是opcode，但只是对高频的代码执行

## 性能优化工具xhprof
